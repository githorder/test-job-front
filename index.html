<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Job Front</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
      crossorigin="anonymous"
    ></script>
  </head>

  <body>
    <div class="container">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">App name</th>
            <th scope="col">Alias</th>
            <th scope="col">Policy</th>
            <th scope="col"></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div
      class="modal fade"
      id="change-app"
      tabindex="-1"
      aria-labelledby="change-app-modal"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" style="max-width: 800px">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="change-app-title">Change App</h1>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <ul class="nav nav-tabs">
              <li class="nav-item">
                <a class="nav-link active" aria-current="settings" href="#"
                  >Main</a
                >
              </li>
            </ul>
            <div class="m-3">
              <form>
                <div class="row mb-3">
                  <label for="app-name-input" class="col-sm-2 col-form-label"
                    >App name</label
                  >
                  <div class="col-sm-10">
                    <input
                      type="text"
                      class="form-control"
                      id="app-name-input"
                    />
                  </div>
                </div>
                <div class="row mb-3">
                  <label for="app-alias-input" class="col-sm-2 col-form-label"
                    >Identificator</label
                  >
                  <div class="col-sm-10">
                    <input
                      type="text"
                      class="form-control"
                      id="app-alias-input"
                    />
                  </div>
                </div>
                <div class="row mb-3">
                  <label for="app-policy-input" class="col-sm-2 col-form-label"
                    >Policy</label
                  >
                  <div class="col-sm-10">
                    <input
                      type="text"
                      class="form-control"
                      id="app-policy-input"
                    />
                  </div>
                </div>
              </form>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button type="button" class="btn btn-primary">Save</button>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.7.0.min.js"
      integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g="
      crossorigin="anonymous"
    ></script>
    <script>
      const state = {};

      function createRow(id, name, alias, policy_id) {
        return `
          <tr class="app-row">
            <td scope="col">${id}</td>
            <td class="app-name-cell" scope="col">${name}</td>
            <td class="app-alias-cell" scope="col">${alias}</td>
            <td class="app-policy-cell" scope="col">${policy_id}</td>
            <td scope="col">
              <button type="button" class="btn btn-change-app" data-bs-toggle="modal" data-bs-target="#change-app">
                <img style="width: 20px;" alt="edit icon" src="./edit.png" />
              </button>
            </td>
          </tr>`;
      }

      async function init() {
        await $.when($.ready);

        const response = await fetch(
          "http://checkstatus.website:8099/Face/App_List",
          {
            method: "POST",
            headers: { "Content-Type": "application/json;charset=UTF-8" },
            body: JSON.stringify(""),
          }
        );
        const apps = await response.json();
        state.apps = apps;

        const { app_table_ids, names, ids, policy_ids } = state.apps;
        app_table_ids.forEach((id, index) => {
          $(".container tbody").append(
            createRow(id, names[index], ids[index], policy_ids[index])
          );
        });

        $(".btn-change-app").each(function (index) {
          $(this).on("click", function () {
            $("#app-name-input").val($(".app-name-cell")[index].textContent);
            $("#app-alias-input").val($(".app-alias-cell")[index].textContent);
            $("#app-alias-input").prop("disabled", true);
            $("#app-policy-input").val(
              $(".app-policy-cell")[index].textContent
            );
          });
        });
      }

      init();
    </script>
  </body>
</html>
